<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>é‡£é­šé™æ§å™¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #111827; color: white; touch-action: manipulation; }
        .btn:active { transform: scale(0.95); background-color: #2563eb; }
    </style>
</head>
<body class="h-screen flex flex-col items-center justify-center p-4 gap-6">

    <!-- ç™»å…¥ -->
    <div id="login" class="flex flex-col gap-4 w-full max-w-xs">
        <h1 class="text-3xl font-bold text-center text-cyan-400">ğŸ£ é‡£é­šå¤§å¸«</h1>
        <input type="text" id="name" placeholder="è¼¸å…¥åå­—" class="p-4 bg-gray-700 rounded-xl text-center text-xl border border-gray-600 focus:border-cyan-400 outline-none">
        <button onclick="connect()" class="bg-cyan-600 hover:bg-cyan-500 p-4 rounded-xl font-bold text-xl">é€£ç·š</button>
    </div>

    <!-- é™æ§å™¨ -->
    <div id="remote" class="hidden w-full max-w-sm">
        <div id="status" class="text-center text-yellow-400 font-bold mb-4 animate-pulse">ç­‰å¾…è€å¸«æŒ‘é¸...</div>
        <div class="grid grid-cols-3 gap-3 w-64 h-64 mx-auto relative">
            <button onclick="send('CAST_UP')" class="bg-blue-600 rounded-xl shadow-[0_4px_0_#1d4ed8] active:shadow-none active:translate-y-1"></button>
            <button onclick="send('CAST_LEFT')" class="bg-blue-600 rounded-xl shadow-[0_4px_0_#1d4ed8] active:shadow-none active:translate-y-1"></button>
            <button onclick="send('REEL')" class="bg-red-600 rounded-full shadow-[0_4px_0_#b91c1c] active:shadow-none active:translate-y-1 text-3xl font-bold flex items-center justify-center">!</button>
            <button onclick="send('CAST_RIGHT')" class="bg-blue-600 rounded-xl shadow-[0_4px_0_#1d4ed8] active:shadow-none active:translate-y-1"></button>
            <button onclick="send('CAST_DOWN')" class="bg-blue-600 rounded-xl shadow-[0_4px_0_#1d4ed8] active:shadow-none active:translate-y-1"></button>
        </div>
    </div>

    <script>
        let ws;
        let isAllowed = false;

        function connect() {
            const name = document.getElementById('name').value;
            if (!name) return alert("è«‹è¼¸å…¥åå­—");
            
            // ä¿®æ”¹é€™è£¡ï¼šwss://fishing-ws-server.onrender.com æ›¿æ›ç‚ºä½  Render éƒ¨ç½²å¾Œçš„ç¶²å€
            ws = new WebSocket('wss://fishing-ws-server.onrender.com'); 

            ws.onopen = () => {
                ws.send(JSON.stringify({ type: 'JOIN', name: name }));
                document.getElementById('login').classList.add('hidden');
                document.getElementById('remote').classList.remove('hidden');
            };

            ws.onmessage = (e) => {
                const d = JSON.parse(e.data);
                const s = document.getElementById('status');
                if (d.type === 'CONTROL_GRANTED') {
                    isAllowed = true;
                    s.innerText = "âœ… ä½ å¯ä»¥æ§åˆ¶ï¼";
                    s.className = "text-green-400 font-bold mb-4 animate-pulse";
                    if (navigator.vibrate) navigator.vibrate([200,100,200]);
                } else if (d.type === 'CONTROL_REVOKED') {
                    isAllowed = false;
                    s.innerText = "ç­‰å¾…è€å¸«å‹¾é¸...";
                    s.className = "text-yellow-400 font-bold mb-4 animate-pulse";
                }
            };
        }

        function send(cmd) {
            if (!isAllowed) return;
            if (ws && ws.readyState === WebSocket.OPEN) {
                ws.send(JSON.stringify({ type: 'INPUT_CMD', command: cmd }));
            }
        }
    </script>
</body>
</html>
